<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>PrettyData — Decor Signals</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font:16px/1.45 system-ui,sans-serif;margin:24px}
    .grid{display:grid;gap:24px;grid-template-columns:1fr 1fr}
    .card{padding:16px;border:1px solid #eee;border-radius:14px;box-shadow:0 2px 6px rgba(0,0,0,.05)}
    h1{margin:0 0 16px} h2{margin:0 0 8px}
  </style>
</head>
<body>
  <h1>PrettyData — Decor Signals</h1>
  <div class="grid">
    <div class="card"><h2>Top Risers</h2><canvas id="inc"></canvas></div>
    <div class="card"><h2>Top Fallers</h2><canvas id="dec"></canvas></div>
  </div>

  <div class="card" style="margin-top:24px">
    <h2>Mentions Over Time (first 6 terms)</h2>
    <canvas id="ts"></canvas>
  </div>

<script>
const BASE = 'https://raw.githubusercontent.com/prettylittledata/prettylittledata/main/data/';

async function loadCSV(name){
  const txt = await fetch(BASE + name + '?t=' + Date.now()).then(r=>r.text());
  const [hdr,...rows] = txt.trim().split('\n');
  const cols = hdr.split(',');
  return rows.map(line=>{
    const parts = line.split(',');
    const obj = {};
    cols.forEach((c,i)=> obj[c] = parts[i]);
    return obj;
  });
}

function bar(el, labels, values, label){
  new Chart(document.getElementById(el), {
    type:'bar',
    data:{ labels, datasets:[{ label, data: values }] },
    options:{ plugins:{ legend:{ display:false } }, scales:{ x:{ ticks:{ autoSkip:false }}}}
  });
}

async function lineTimeseries(){
  const ts = await loadCSV('decor_term_counts_over_time.csv');
  const byTerm = {};
  ts.forEach(r=>{
    if(!byTerm[r.Term]) byTerm[r.Term] = [];
    byTerm[r.Term].push({x: r.period, y: +r.Count});
  });
  const terms = Object.keys(byTerm).slice(0,6);
  new Chart(document.getElementById('ts'), {
    type:'line',
    data:{ datasets: terms.map(t=>({ label:t, data: byTerm[t].sort((a,b)=>a.x.localeCompare(b.x)) })) },
    options:{ parsing:false, scales:{ x:{ type:'time', time:{ unit:'week' }}}}
  });
}

(async ()=>{
  const inc = await loadCSV('decor_increasing_terms.csv');
  const dec = await loadCSV('decor_decreasing_terms.csv');
  bar('inc', inc.map(d=>d.Term), inc.map(d=>+d.estimate), 'Slope (↑ rising)');
  bar('dec', dec.map(d=>d.Term), dec.map(d=>+d.estimate), 'Slope (↓ falling)');
  await lineTimeseries();
})();
</script>
</body>
</html>
